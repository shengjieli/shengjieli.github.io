# itertools â€” ä¸ºé«˜æ•ˆå¾ªç¯è€Œåˆ›å»ºè¿­ä»£å™¨çš„å‡½æ•°

ä»Šå¤©æˆ‘ä»¬æ¥ä»‹ç»ä¸€ä¸ªPythonçš„æ¨¡å—itertoolsï¼Œitertoolsæ˜¯ä¸€ä¸ªå¿«é€Ÿã€é«˜æ•ˆåˆ©ç”¨å†…å­˜çš„åˆ›å»ºè¿­ä»£å™¨çš„æ ¸å¿ƒå·¥å…·é›†ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„å·¥å…·ã€‚

æœ¬ç¯‡ä»£ç å¤§éƒ¨åˆ†åŸºäºPython2.7ï¼Œé™¤éç‰¹æ®Šè¯´æ˜ã€‚

itertoolsæ¨¡å—ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§è¿­ä»£å™¨ï¼š

- æ— é™è¿­ä»£å™¨
- æ ¹æ®æœ€çŸ­è¾“å…¥åºåˆ—é•¿åº¦åœæ­¢çš„è¿­ä»£å™¨
- ç»„åˆè¿­ä»£å™¨


### ä¸€ã€æ— é™è¿­ä»£å™¨

#### count(start=0ï¼Œstep=1)
åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿”å›ä»¥startå¼€å§‹æ¯æ¬¡å¢åŠ stepçš„å€¼ã€‚

å…¶å®å°±ç›¸å½“äºï¼š
```python
def count(start=0, step=1):
    # count(10) --> 10 11 12 13 14 ...
    # count(2.5, 0.5) -> 2.5 3.0 3.5 ...
    n = start
    while True:
        yield n
        n += step
```
æˆ–ï¼š
```python
(startÂ +Â stepÂ *Â iÂ forÂ iÂ inÂ count())  # è¿™æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œä¸æ˜¯tuple
```

ä¾‹å¦‚ï¼š
```python
from itertools import count

for i in count(3, 2):
    print i
```
ä¼šè¾“å‡ºä»€ä¹ˆå‘¢ï¼Ÿè‡ªå·±å»è¯•ä¸€ä¸‹å§ğŸ˜

#### cycle(iterable)
åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿”å›Â iterableÂ ä¸­æ‰€æœ‰å…ƒç´ å¹¶ä¿å­˜ä¸€ä¸ªå‰¯æœ¬ã€‚å½“å–å®ŒÂ iterableÂ ä¸­æ‰€æœ‰å…ƒç´ ï¼Œè¿”å›å‰¯æœ¬ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚æ— é™é‡å¤ã€‚

å°±ç›¸å½“äºï¼š
```python
def cycle(iterable):
    # cycle('ABCD') --> A B C D A B C D A B C D ...
    saved = []
    for element in iterable:
        yield element
        saved.append(element)
    while saved:
        for element in saved:
              yield element
```
**æ³¨æ„ï¼šè¯¥å‡½æ•°å¯èƒ½éœ€è¦ä¸€å®šçš„ç©ºé—´ï¼Œå› ä¸ºè¦å¤åˆ¶ä¸€ä»½iterableã€‚**

ä¾‹å¦‚ï¼š
```python
from itertools import cycle

for i in cycle([1,2,3,4]):
    print i
```
è¾“å‡ºï¼š
ä¼šä¸€ç›´ç”Ÿæˆ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œ4...

#### repeat(object[, times])
åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œé‡å¤ç”Ÿæˆobjectï¼Œå¦‚æœä¼ å…¥äº†timeså‚æ•°ï¼Œå°±ç”Ÿæˆtimesæ¬¡ï¼Œå¦åˆ™ï¼Œä¸€ç›´ç”Ÿæˆã€‚

ç›¸å½“äºï¼š
```python
def repeat(object, times=None):
    # repeat(10, 3) --> 10 10 10
    if times is None:
        while True:
            yield object
    else:
        for i in xrange(times):
            yield object
```

ä¾‹å¦‚ï¼š
```python
from itertools import repeat

for i in repeat('over-and-over', 3):
    print i
```
è¾“å‡ºï¼š
over-and-over
over-and-over
over-and-over


### äºŒã€æ ¹æ®æœ€çŸ­è¾“å…¥åºåˆ—é•¿åº¦åœæ­¢çš„è¿­ä»£å™¨

#### chain(\*iterable)
åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œå…ˆè¿”å›ç¬¬ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ä¸­çš„å…ƒç´ ï¼Œå†è¿”å›ä¸‹ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ä¸­çš„å…ƒç´ ï¼Œç›´åˆ°æ‰€æœ‰å¯è¿­ä»£å¯¹è±¡ä¸­çš„å…ƒç´ è¿”å›å®Œï¼Œå¯ä»¥ä¸€æ¬¡è¿ç»­è¿­ä»£å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ã€‚
ç›¸å½“äºï¼š
```python
def chain(*iterables):
    # chain('ABC', 'DEF') --> A B C D E F
    for it in iterables:
        for element in it:
            yield element
```

ä¾‹å¦‚ï¼š
```python
from itertools import chain

print list(chain([1, 2, 3], ['a', 'b', 'c']))
```
è¾“å‡ºï¼š
[1, 2, 3, 'a', 'b', 'c']

#### compress(data, selectors)

åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œå®ƒè¿”å›Â dataÂ ä¸­ç»Â selectorsÂ çœŸå€¼æµ‹è¯•ä¸ºÂ TrueÂ çš„å…ƒç´ ã€‚è¿­ä»£å™¨åœ¨ä¸¤è€…è¾ƒçŸ­çš„é•¿åº¦å¤„åœæ­¢ã€‚

ç›¸å½“äºï¼š
```python
def compress(data, selectors):
    # compress('ABCDEF', [1,0,1,0,1,1]) --> A C E F
    return (d for d, s in izip(data, selectors) if s)
```

ä¾‹å¦‚ï¼š
```python
from itertools import compress

print list(compress('ABCDEF', [1,0,1,0,1,1]))
```
è¾“å‡ºï¼š
['A', 'C', 'E', 'F']

#### dropwhile(predicate, iterable)
åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¯¹iterableä¸­æ¯ä¸€é¡¹è°ƒç”¨predicateå‡½æ•°ï¼Œå¦‚æœpredicateå‡½æ•°è¿”å›Trueï¼Œä¸¢å¼ƒè¯¥é¡¹ï¼Œç›´åˆ°predicateå‡½æ•°è¿”å›Falseæ—¶ï¼Œè¿”å›è¯¥é¡¹å’Œåè¾¹æ‰€æœ‰é¡¹ã€‚

ç›¸å½“äºï¼š
```python
def dropwhile(predicate, iterable):
    # dropwhile(lambda x: x<5, [1,4,6,4,1]) --> 6 4 1
    iterable = iter(iterable)
    for x in iterable:
        if not predicate(x):
            yield x
            break
    for x in iterable:
        yield x
```

ä¾‹å¦‚ï¼š
```python
from itertools import dropwhile

print list(dropwhile(lambda x:x>0, [1,2,3,-4,5,6,5,7]))
```
è¾“å‡ºï¼š
[-4, 5, 6, 5, 7]

#### takewhile()
å’Œdropwhileç›¸åï¼Œåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¯¹iterableä¸­æ¯ä¸€é¡¹è°ƒç”¨predicateå‡½æ•°ï¼Œå¦‚æœpredicateå‡½æ•°è¿”å›Falseï¼Œä¸¢å¼ƒè¯¥é¡¹ï¼Œç›´åˆ°predicateå‡½æ•°è¿”å›Trueæ—¶ï¼Œè¿”å›è¯¥é¡¹å’Œåè¾¹æ‰€æœ‰é¡¹ã€‚

#### groupby(iterableÂ [ï¼ŒkeyÂ ])
åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¯¹iterableçš„æ¯ä¸ªå…ƒç´ è°ƒç”¨keyå‡½æ•°ï¼Œå½“è¿”å›å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¾“å‡ºå…ƒç´ çš„é”®å’Œè¿ç»­çš„å…ƒç´ è¿­ä»£å™¨ï¼Œç›´åˆ°è¿”å›å€¼å˜åŒ–æ—¶ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„é”®å’Œåç»­çš„è¿ç»­çš„å…ƒç´ è¿­ä»£å™¨ã€‚keyÂ æ˜¯ä¸€ä¸ªè®¡ç®—å…ƒç´ é”®å€¼å‡½æ•°ã€‚å¦‚æœæœªæŒ‡å®šæˆ–ä¸ºÂ Noneï¼ŒkeyÂ ç¼ºçœä¸ºæ’ç­‰å‡½æ•°ï¼ˆidentity functionï¼‰ï¼Œè¿”å›å…ƒç´ ä¸å˜ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒiterableÂ éœ€ç”¨åŒä¸€ä¸ªé”®å€¼å‡½æ•°é¢„å…ˆæ’åºã€‚

> groupby()Â æ“ä½œç±»ä¼¼äºUnixä¸­çš„Â uniqã€‚å½“æ¯æ¬¡Â keyÂ å‡½æ•°äº§ç”Ÿçš„é”®å€¼æ”¹å˜æ—¶ï¼Œè¿­ä»£å™¨ä¼šåˆ†ç»„æˆ–ç”Ÿæˆä¸€ä¸ªæ–°ç»„ï¼ˆè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé€šå¸¸éœ€è¦ä½¿ç”¨åŒä¸€ä¸ªé”®å€¼å‡½æ•°å…ˆå¯¹æ•°æ®è¿›è¡Œæ’åºï¼‰ã€‚è¿™ç§è¡Œä¸ºä¸SQLçš„GROUP BYæ“ä½œä¸åŒï¼ŒSQLçš„æ“ä½œä¼šå¿½ç•¥è¾“å…¥çš„é¡ºåºå°†ç›¸åŒé”®å€¼çš„å…ƒç´ åˆ†åœ¨åŒç»„ä¸­ã€‚

ä¾‹å¦‚ï¼š
```python
# æŒ‰ç…§åˆ†æ•°åˆ†ç»„
from itertools import groupby

data = [{'score':99,'name':'Steve'},{'score':98,'name':'Mara'},{'score':99,'name':'Tom'}]
key = lambda x:x['score']
for each in groupby(sorted(data, key=key), key=key):
    print each[0],list(each[1])
```
è¾“å‡ºï¼š
98 [{'score': 98, 'name': 'Mara'}]
99 [{'score': 99, 'name': 'Steve'}, {'score': 99, 'name': 'Tom'}]

#### itertools.islice(iterable,Â stop)
#### itertools.islice(iterable,Â start,Â stop[,Â step])
åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œç”Ÿæˆé¡¹çš„æ–¹å¼ç±»ä¼¼äºåˆ‡ç‰‡ï¼šÂ iterable[start : stop : step]ï¼Œå°†è·³è¿‡å‰startä¸ªé¡¹ï¼Œè¿­ä»£åœ¨stopæ‰€æŒ‡å®šçš„ä½ç½®åœæ­¢ï¼ŒstepæŒ‡å®šç”¨äºè·³è¿‡é¡¹çš„æ­¥å¹…ã€‚ä¸åˆ‡ç‰‡ä¸åŒï¼Œè´Ÿå€¼ä¸ä¼šç”¨äºä»»ä½•startï¼Œstopå’Œstepï¼Œå¦‚æœçœç•¥äº†startï¼Œè¿­ä»£å°†ä»0å¼€å§‹ï¼Œå¦‚æœçœç•¥äº†stepï¼Œæ­¥å¹…å°†é‡‡ç”¨1ã€‚

#### starmap(function, iterable)
åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œç”Ÿæˆå€¼func(\*item),å…¶ä¸­itemæ¥è‡ªiterableï¼Œstarmapå’Œimapçš„åŒºåˆ«ç±»ä¼¼äºfunction(a,b)å’Œfunction(\*c)

ç›¸å½“äºï¼š
```python
def starmap(function, iterable):
    # starmap(pow, [(2,5), (3,2), (10,3)]) --> 32 9 1000
    for args in iterable:
        yield function(*args)
```

ä¾‹å¦‚ï¼š
```python
from itertools import starmap

print list(starmap(pow, [(2,5), (3,2), (10,3)]))
```
è¾“å‡ºï¼š
[32, 9, 1000]

#### tee(iterable[, n=2])
ä»iterableåˆ›å»ºnä¸ªç‹¬ç«‹çš„è¿­ä»£å™¨ï¼Œåˆ›å»ºçš„è¿­ä»£å™¨ä»¥nå…ƒç»„çš„å½¢å¼è¿”å›ï¼Œnçš„é»˜è®¤å€¼ä¸º2ï¼Œæ­¤å‡½æ•°é€‚ç”¨äºä»»ä½•å¯è¿­ä»£çš„å¯¹è±¡ï¼Œä½†æ˜¯ï¼Œä¸ºäº†å…‹éš†åŸå§‹è¿­ä»£å™¨ï¼Œç”Ÿæˆçš„é¡¹ä¼šè¢«ç¼“å­˜ï¼Œå¹¶åœ¨æ‰€æœ‰æ–°åˆ›å»ºçš„è¿­ä»£å™¨ä¸­ä½¿ç”¨ï¼Œä¸€å®šè¦æ³¨æ„ï¼Œä¸è¦åœ¨è°ƒç”¨tee()ä¹‹åä½¿ç”¨åŸå§‹è¿­ä»£å™¨iterableï¼Œå¦åˆ™ç¼“å­˜æœºåˆ¶å¯èƒ½æ— æ³•æ­£ç¡®å·¥ä½œã€‚

ä¾‹å¦‚ï¼š
```python
from itertools import tee

print [list(each) for each in tee([1,2,3], 3)]
```
è¾“å‡ºï¼š
[[1, 2, 3], [1, 2, 3], [1, 2, 3]]

#### ifilter(predicate, iterable)
ç±»ä¼¼äºå†…ç½®å‡½æ•° filter() ,åªä¸è¿‡è¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚

#### ifilterfalse(predicate, iterable)
ä¸ifilterç›¸åã€‚

#### izip(\*iterables)
ç±»ä¼¼äºå†…ç½®å‡½æ•° zip() ,åªä¸è¿‡è¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚

#### izip_longest(\*iterables[, fillvalue])
å’Œizip()å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œizip()ä¼šä¸€ç›´æŒç»­åˆ°æ‰€æœ‰è¿­ä»£å˜é‡éƒ½è¿­ä»£å®Œæˆæ—¶æ‰åœæ­¢ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨fillvalueå…³é”®å­—å‚æ•°æŒ‡å®šä¸åŒçš„å€¼ï¼Œåˆ™ä½¿ç”¨Noneæ¥å¡«å……å·²ç»ä½¿ç”¨çš„è¿­ä»£å˜é‡çš„å€¼ã€‚

#### imap()
ç±»ä¼¼äºå†…ç½®å‡½æ•° map() ,åªä¸è¿‡è¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚

**åœ¨Python3ä¸­filter()ï¼Œzip(),map()å‡½æ•°æœ¬æ¥è¿”å›çš„å°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œæ‰€ä»¥Python3çš„itertoolsæ¨¡å—æ²¡æœ‰è¿™å‡ ä¸ªå‡½æ•°**

### ä¸‰ã€ç»„åˆè¿­ä»£å™¨


#### product(\*iterables[, repeat])

ç¬›å¡å„¿ç§¯ï¼šåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œç”Ÿæˆè¡¨ç¤ºitem1ï¼Œitem2ç­‰ä¸­çš„é¡¹ç›®çš„ç¬›å¡å°”ç§¯çš„å…ƒç»„ï¼Œrepeatæ˜¯ä¸€ä¸ªå…³é”®å­—å‚æ•°ï¼ŒæŒ‡å®šé‡å¤ç”Ÿæˆåºåˆ—çš„æ¬¡æ•°ã€‚ä¾‹å¦‚ï¼Œproduct(A,Â repeat=4)Â å’ŒÂ product(A,Â A,Â A,Â A)Â æ˜¯ä¸€æ ·çš„ã€‚

ä¾‹å¦‚ï¼š
```python
from itertools import product

print list(product('123','abc'))
print list(product('ABCD', repeat=2))
```
è¾“å‡ºï¼š
[('1', 'a'), ('1', 'b'), ('1', 'c'), ('2', 'a'), ('2', 'b'), ('2', 'c'), ('3', 'a'), ('3', 'b'), ('3', 'c')]
[('A', 'A'), ('A', 'B'), ('A', 'C'), ('A', 'D'), ('B', 'A'), ('B', 'B'), ('B', 'C'), ('B', 'D'), ('C', 'A'), ('C', 'B'), ('C', 'C'), ('C', 'D'), ('D', 'A'), ('D', 'B'), ('D', 'C'), ('D', 'D')]

#### permutations(iterableÂ [ï¼ŒrÂ ])
æ’åˆ—ï¼šåˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿”å›iterableä¸­æ‰€æœ‰é•¿åº¦ä¸ºrçš„é¡¹ç›®åºåˆ—ï¼Œå¦‚æœçœç•¥äº†rï¼Œé‚£ä¹ˆåºåˆ—çš„é•¿åº¦ä¸iterableä¸­çš„é¡¹ç›®æ•°é‡ç›¸åŒã€‚

ä¾‹å¦‚ï¼š
```python
from itertools import permutations

print list(permutations('ABCD', 2))
```
è¾“å‡ºï¼š
[('A', 'B'), ('A', 'C'), ('A', 'D'), ('B', 'A'), ('B', 'C'), ('B', 'D'), ('C', 'A'), ('C', 'B'), ('C', 'D'), ('D', 'A'), ('D', 'B'), ('D', 'C')]

#### combinations(iterable,Â r)

åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿”å›iterableä¸­æ‰€æœ‰é•¿åº¦ä¸ºrçš„å­åºåˆ—ï¼Œè¿”å›çš„å­åºåˆ—ä¸­çš„é¡¹æŒ‰è¾“å…¥iterableä¸­çš„é¡ºåºæ’åº (æ¯ä¸ªå…ƒç»„ä¸­çš„å…ƒç´ ä¸èƒ½é‡å¤)

ä¾‹å¦‚ï¼š
```python
from itertools import combinations

print list(combinations('ABCD', 2))
```
è¾“å‡ºï¼š
[('A', 'B'), ('A', 'C'), ('A', 'D'), ('B', 'C'), ('B', 'D'), ('C', 'D')]

#### combinations_with_replacement(iterable,Â r)

åˆ›å»ºä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿”å›iterableä¸­æ‰€æœ‰é•¿åº¦ä¸ºrçš„å­åºåˆ—ï¼Œè¿”å›çš„å­åºåˆ—ä¸­çš„é¡¹æŒ‰è¾“å…¥iterableä¸­çš„é¡ºåºæ’åº (å¸¦é‡å¤)

ä¾‹å¦‚ï¼š
```python
from itertools import combinations_with_replacement

print list(combinations_with_replacement('ABCD', 2))
```
è¾“å‡ºï¼š
[('A', 'A'), ('A', 'B'), ('A', 'C'), ('A', 'D'), ('B', 'B'), ('B', 'C'), ('B', 'D'), ('C', 'C'), ('C', 'D'), ('D', 'D')]
